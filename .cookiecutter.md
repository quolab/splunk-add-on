# This project was created by Cookiecutter

## Source Template

**Template:** /Users/lalleman/Sandbox/cypress-cookiecutter/search-command

**Version:** v1.1.0


## Re-create

### Overview
Before re-applying a new template version over a previous version, it's helpful to have a branch dedicated for the purpose and to have a clean clone of the code base with the latest cookiecutter-only version of the code base.
Having good commit messages showing which version of the cookiecutter template that was last applied is quite helpful here.
The full maintenance steps are a bit too involved to list here, but a few key steps include:

 1. Have a clean working tree.  (`git status` should return NO staged or unknown files and so on)
 1. Checkout a clean copy of the latest cookiecutter-only branch.  (Simply named `cookiecutter` in this example)
 1. Remove all git-tracked files to ensure that renames or removed files are tracked correctly
 1. Re-run the cookiecutter template overtop of the original directory.
 1. Restore any local/custom files (hopefully there are none; this is the point of the dedicated branch, right?)
 1. Commit / push changes.  Make sure to use the commit messages that indicate updated template version.
 1. Merge in changes to your primary branch and address changes.  There may be lots of changes you don't need/want to apply.

### Steps
Check out a fresh copy of the upgrade branch.  The example here uses git `worktree` feature to save a few steps, and avoid clobbering the wrong folder, but it's not required.  Remember to update the branch name (`cookiecutter`) if yours is different:
```bash
$ git fetch
$ mkdir COOKIECUTTER_UPDATE
$ git worktree add COOKIECUTTER_UPDATE/TA-quolab cookiecutter
Preparing worktree (checking out 'cookiecutter')
HEAD is now at 803ca4d Update to cookiecutter cypress_ta_spl.git@0.4.0
```

Switch to the fresh checkout and confirm that it's untouched using `git status`.
```bash
$ cd COOKIECUTTER_UPDATE/TA-quolab

$ git pull
$ git status
On branch cookiecutter
Your branch is up to date with 'origin/cookiecutter'.

nothing to commit, working tree clean
```

Remove all existing files known to git.  This will allow detection of renames and the like with less fuss.  You can confirm this with `tree`, if you'd like.  (Note the `0 files` line in the output)
```
$ git ls-files | xargs rm
(no output)

$ tree
.
├── README
├── appserver
│   └── static
│       ├── javascript
│       │   ├── vendor
│       │   └── views
│       └── styles
├── bin
├── default
│   └── data
│       └── ui
│           ├── nav
│           └── views
├── metadata
└── static

15 directories, 0 files
```

Make sure that you run the next step in the folder above the one that contains your TA.
For example, if you're following along with the commands here, the `cookiecutter` command must run from `COOKIECUTTER_UPDATE`.
```bash
cd ..
# IMPORTANT!  Double check that you are in the correct folder
$ pwd
/Users/jdoe/Sandbox/TA-quolab/COOKIECUTTER_UPDATE
```

Now it's finally time to re-apply cookiecutter to rebase your version with a new upstream release.
Ensure that the version number on the following command is updated to match the **new** version.
The latest version available is listed on the GitHub [releases](https://github.com/Kintyre/cypress_ta_spl/releases) page.
HINT:  Look out for new parameters or modifications that need to be applied.

```bash
cookiecutter /Users/lalleman/Sandbox/cypress-cookiecutter/search-command --checkout v1.1.0 -f \
    	layer="50-spl-quolabquery" \
    	vendor="QuoLab" \
    	vendor_product="QuoLab" \
    	app_folder="TA-quolab" \
    	app_label="QuoLab Add-on for Splunk" \
    	author_email="splunkbase@kintyre.co" \
    	spl_class="QuoLabQueryCommand" \
    	spl_script="quolab_query" \
    	spl_command="quolabquery" \
    	spl_type="Generating" \
    	need_auth="True" \
    	conf_name="quolab_servers" \
    	conf_type="server" \
    	json_output=true


You've downloaded /Users/jdoe/.cookiecutters/cypress_ta_spl before. Is it okay to delete and re-download it? [yes]: yes
vendor [QuoLab]:
vendor_product [QuoLab]:
app_folder [TA-quolab]:
.
.
.
on_splunkbase [False]:
(end of parameters)

Passed parameter validation!
Keeping build files for GitHub_Actions:  ['.github/workflows/build.yml']
Post-hook complete!
```

Then add all files and run pre-commit (this may take more than one round):
```bash
$ cd TA-quolab
$ git add .
$ pre-commit run --all
$ git add -u
$ git status
```

Review the changes about to be committed:
```
$ git diff --cached
```

Commit with a message like so:

```bash
$ git commit -am "Update to cookiecutter search-command@1.1.0"
$ git push
```

Cleanup the worktree and start the wonderful process of merging in the latest version.
```bash
$ cd ../..
~/Sandbox/TA-quolab [master]

$ git worktree remove COOKIECUTTER_UPDATE/TA-quolab
$ git checkout master
$ git pull
Already up to date.
$ git merge cookiecutter
.
.
.
Automatic merge failed; fix conflicts and then commit the result.
```

Again, starting from a clean working tree, and possibly a dedicated merge branch, here is a good idea, but beyond the scope of this doc.

## Merge tips:

For file with a merge conflict, or highly customized files where you do not want to accept incoming changes from the updated cookiecutter template, you can use `git checkout` to keep your version, using something like:

```bash
git checkout --ours TA-quolab/bin/quolab_query.py
```


## Gotchas

When upgrading to a new version of a cookiecutter template, one challenge can be determining which copy of this `.cookiecutter.md` file to use.
There's no solid recommendation here yet, but one possibility is to pre-upgrade the `.cookiecutter.md` files to get a "preview" of what the new version looks like, or switch over to the new doc as soon as cookiecutter is run.
Another option is to look at the templated version in the git repo.
Either way, good luck!
