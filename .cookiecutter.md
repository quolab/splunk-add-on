# This project was created by Cookiecutter

## Source Template

**Template:** https://github.com/Kintyre/cypress_ta_spl.git
**Version:** v0.5.0


## Re-create

### Overview
Before re-applying a new template version over a previous version, it's helpful to have a branch dedicated for the purpose and to have a clean clone of the code base with the latest cookiecutter-only version of the code base.
Having good commit messages showing which version of the cookiecutter template that was last applied is quite helpful here.
The full maintenance steps are a bit too involved to list here, but a few key steps include:

    1. Have a clean working tree.  (`git status` should return NO staged or unknown files and so on)
    1. Checkout a clean copy of the latest cookiecutter-only branch.  (Simply named `cookiecutter` in this example)
    1. Remove all git-tracked files to ensure that renames or removed files are tracked correctly
    1. Re-run the cookiecutter template overtop of the original directory.
    1. Restore any local/custom files (hopefully there are none; this is the point of the dedicated branch.)
    1. Commit / push changes.  Make sure to use the commit messages that indicate updated template version.
    1. Merge in changes to your primary branch and address changes.  There may be lots of changes you don't need to apply.

Check out a fresh copy of the upgrade branch.  The example here uses git `worktree` feature to save a few steps, but that's not required.
```bash
$ mkdir COOKIECUTTER_UPDATE

$ git worktree add COOKIECUTTER_UPDATE/TA-quolab cookiecutter
Preparing worktree (checking out 'cookiecutter')
HEAD is now at 803ca4d Update to cookiecutter cypress_ta_spl.git@0.4.0
```

Switch to the fresh checkout and confirm that it's untouched using `git status`.
```bash
$ cd COOKIECUTTER_UPDATE/TA-quolab

$ git status
On branch cookiecutter
Your branch is up to date with 'origin/cookiecutter'.

nothing to commit, working tree clean
```

Remove all existing files known to git.  This will allow detection of renames and the like with less fuss.  You can confirm this with `tree`, if you'd like.  (Note the `0 files` line in the output)
```
$ git ls-files | xargs rm
(no output)

$ tree
.
├── README
├── appserver
│   └── static
│       ├── javascript
│       │   ├── vendor
│       │   └── views
│       └── styles
├── bin
├── default
│   └── data
│       └── ui
│           ├── nav
│           └── views
├── metadata
└── static

15 directories, 0 files
```

Make sure that you run the next step in the folder above the one that contains your TA.
For example, if you're following along, cookiecutter must run from the `COOKIECUTTER_UPDATE` folder.
```bash
cd ..

# Double check that this is the correct folder
$ pwd
/Users/jdoe/Sandbox/TA-quolab/COOKIECUTTER_UPDATE
```

Now it's finally time to re-apply cookiecutter to rebase your version with a new upstream release.
HINT:  Look out for new parameters or modifications that need to be applied.

```bash
cookiecutter https://github.com/Kintyre/cypress_ta_spl.git --checkout v0.5.0 \
    	vendor="QuoLab" \
    	vendor_product="QuoLab" \
    	app_folder="TA-quolab" \
    	app_label="QuoLab add-on for Splunk" \
    	build_tool="GitHub_Actions" \
    	author_splunkid="kintyre" \
    	author_email="splunkbase@kintyre.co" \
    	author_company="Kintyre" \
    	spl_class="QuoLabQueryCommand" \
    	spl_script="quolab_query" \
    	spl_command="quolabquery" \
    	spl_type="Generating" \
    	need_auth=true \
    	allow_insecure=true \
    	secret_name="secret" \
    	need_conf=true \
    	conf_name="quolab_servers" \
    	conf_type="server" \
    	conf_fields="url,username,max_batch_size,max_execution_time,verify" \
    	rest_name="quolab_servers" \
    	json_output=true \
    	on_splunkbase=true
```

Then add all files and run pre-commit (this may take more than one round):
```bash
$ cd TA-quolab
$ git add .
$ pre-commit run --all
```

Commit with a message like so:

```bash
$ git commit -am "Update to cookiecutter cypress_ta_spl.git@0.5.0"
```
